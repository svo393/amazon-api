# Migration `20200422222247-init3`

This migration has been generated by Sergei Ovchinnikov at 4/22/2020, 10:22:47 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Category" DROP CONSTRAINT IF EXiSTS "Category_parentID_fkey",
ALTER COLUMN "parentID" DROP NOT NULL;

ALTER TABLE "public"."Item" ALTER COLUMN "asin" DROP DEFAULT;

ALTER TABLE "public"."Order" ALTER COLUMN "status" SET DEFAULT 'NEW';

ALTER TABLE "public"."User" ALTER COLUMN "role" SET DEFAULT 'USER';

ALTER TABLE "public"."Vendor" ADD COLUMN "name" text  NOT NULL ;

CREATE UNIQUE INDEX "Category.name" ON "public"."Category"("name")

CREATE UNIQUE INDEX "Vendor.name" ON "public"."Vendor"("name")

ALTER TABLE "public"."Category" ADD FOREIGN KEY ("parentID")REFERENCES "public"."Category"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200422175707-wip1..20200422222247-init3
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -14,9 +14,9 @@
   shortDescription String
   longDescription  String
   stock            Int
   stars            Int
-  asin             String     @default("tnt-655-34")
+  asin             String
   media            Int
   primaryMedia     Int
   createdAt        DateTime   @default(now())
   updatedAt        DateTime   @updatedAt
@@ -31,16 +31,17 @@
   vendorID         String
 }
 model Category {
-  id       String   @default(cuid()) @id
-  name     String
-  parent   Category @relation("CategoryToCategory", fields: [parentID], references: [id])
-  parentID String
+  id       String    @default(cuid()) @id
+  name     String    @unique
+  parent   Category? @relation("CategoryToCategory", fields: [parentID], references: [id])
+  parentID String?
 }
 model Vendor {
-  id String @default(cuid()) @id
+  id   String @default(cuid()) @id
+  name String @unique
 }
 model User {
   id               String      @default(cuid()) @id
```


